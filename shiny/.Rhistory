hemi = case_when(
str_detect(abv, "lh$") ~ "left",
str_detect(abv, "rh$") ~ "right",
TRUE ~ NA_character_
)
) %>%
rowwise() %>%
mutate(region = get_name(dk_abv_to_names, abv)) %>%
ungroup()
area_male_RMSE_ind_region <- area_male_RMSE_ind_region %>%
mutate(
abv = str_remove(region_raw, "^smri_area_cdk_"),
abv = str_remove(abv, "\\.combat$")
) %>%
mutate(
hemi = case_when(
str_detect(abv, "lh$") ~ "left",
str_detect(abv, "rh$") ~ "right",
TRUE ~ NA_character_
)
) %>%
filter(!abv %in%
c("total", "totallh", "totalrh")) %>%
rowwise() %>%
mutate(region = get_name(dk_abv_to_names, abv)) %>%
ungroup()
area_female_RMSE_ind_region <- area_female_RMSE_ind_region %>%
mutate(
abv = str_remove(region_raw, "^smri_area_cdk_"),
abv = str_remove(abv, "\\.combat$")
) %>%
mutate(
hemi = case_when(
str_detect(abv, "lh$") ~ "left",
str_detect(abv, "rh$") ~ "right",
TRUE ~ NA_character_
)
) %>%
filter(!abv %in%
c("total", "totallh", "totalrh")) %>%
rowwise() %>%
mutate(region = get_name(dk_abv_to_names, abv)) %>%
ungroup()
dk_df <- as_tibble(dk)
male_joined <- brain_join(dk_df, area_male_RMSE_ind_region, by = c("region", "hemi"))
male_plot <- male_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.06, 0.39)
) +
theme_void()
female_joined <- brain_join(dk_df, area_female_RMSE_ind_region, by = c("region", "hemi"))
female_plot <- female_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Female") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.06, 0.39)
) +
theme_void()
male_plot
female_plot
dk_df <- as_tibble(dk)
male_joined <- brain_join(dk_df, area_male_RMSE_ind_region, by = c("region", "hemi"))
male_plot <- male_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
) +
theme_void()
female_joined <- brain_join(dk_df, area_female_RMSE_ind_region, by = c("region", "hemi"))
female_plot <- female_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Female") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
) +
theme_void()
male_plot
female_plot
area_male_RMSE_ind_region_long <- area_centile_male %>%
select(current_col_name, race_ethnicity,
residual_baseline_year_1_arm_1,
residual_2_year_follow_up_y_arm_1,
residual_4_year_follow_up_y_arm_1) %>%
pivot_longer(
cols = starts_with("residual_"),
names_to = "event_time",
values_to = "residual"
) %>%
mutate(residual_sqr = residual^2) %>%
mutate(event_time = case_when(
str_detect(event_time, "baseline") ~ "Baseline",
str_detect(event_time, "2_year") ~ "Year 2",
str_detect(event_time, "4_year") ~ "Year 4"
))
area_male_RMSE_ind_region_event <- area_male_RMSE_ind_region_long %>%
group_by(current_col_name, race_ethnicity, event_time) %>%
summarize(
RMSE_residual = sqrt(mean(residual_sqr, na.rm = TRUE)),
.groups = "drop"
) %>%
rename(region_raw = current_col_name)
overall_area_male_RMSE_ind_region_event <- area_male_RMSE_ind_region_long %>%
group_by(current_col_name, event_time) %>%
summarize(
race_ethnicity = "All",
RMSE_residual = sqrt(mean(residual_sqr, na.rm = TRUE)),
.groups = "drop"
) %>%
rename(region_raw = current_col_name)
area_male_RMSE_ind_region_event <- bind_rows(
area_male_RMSE_ind_region_event,
overall_area_male_RMSE_ind_region_event
)
area_male_RMSE <- area_male_RMSE_ind_region_event %>%
mutate(
abv = str_remove(region_raw, "^smri_area_cdk_"),
abv = str_remove(abv, "\\.combat$")
) %>%
mutate(
hemi = case_when(
str_detect(abv, "lh$") ~ "left",
str_detect(abv, "rh$") ~ "right",
TRUE ~ NA_character_
)
) %>%
filter(!abv %in%
c("total", "totallh", "totalrh")) %>%
rowwise() %>%
mutate(region = get_name(dk_abv_to_names, abv)) %>%
ungroup() %>%
filter(!region %in%
c("Mean cortical thickness for whole brain",
"Mean cortical thickness for left hemisphere",
"Mean cortical thickness for right hemisphere"))
area_male_RMSE_baseline <- area_male_RMSE %>%
filter(event_time == "Baseline")
area_male_RMSE_year2 <- area_male_RMSE %>%
filter(event_time == "Year 2")
area_male_RMSE_year4 <- area_male_RMSE %>%
filter(event_time == "Year 4")
male_baseline_joined <- brain_join(dk_df, area_male_RMSE_baseline, by = c("region", "hemi"))
male_year2_joined <- brain_join(dk_df, area_male_RMSE_year2, by = c("region", "hemi"))
male_year4_joined <- brain_join(dk_df, area_male_RMSE_year4, by = c("region", "hemi"))
male_baseline_plot <- male_baseline_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Baseline Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.05, 0.39)
) +
theme_void()
male_year2_plot <- male_year2_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 2 Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.05, 0.39)
) +
theme_void()
male_year4_plot <- male_year4_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 4 Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.05, 0.39)
) +
theme_void()
male_baseline_plot
male_year2_plot
male_year4_plot
area_male_RMSE <- area_male_RMSE_ind_region_event %>%
mutate(
abv = str_remove(region_raw, "^smri_area_cdk_"),
abv = str_remove(abv, "\\.combat$")
) %>%
mutate(
hemi = case_when(
str_detect(abv, "lh$") ~ "left",
str_detect(abv, "rh$") ~ "right",
TRUE ~ NA_character_
)
) %>%
filter(!abv %in%
c("total", "totallh", "totalrh")) %>%
rowwise() %>%
mutate(region = get_name(dk_abv_to_names, abv)) %>%
ungroup()
area_male_RMSE_baseline <- area_male_RMSE %>%
filter(event_time == "Baseline")
area_male_RMSE_year2 <- area_male_RMSE %>%
filter(event_time == "Year 2")
area_male_RMSE_year4 <- area_male_RMSE %>%
filter(event_time == "Year 4")
male_baseline_joined <- brain_join(dk_df, area_male_RMSE_baseline, by = c("region", "hemi"))
male_year2_joined <- brain_join(dk_df, area_male_RMSE_year2, by = c("region", "hemi"))
male_year4_joined <- brain_join(dk_df, area_male_RMSE_year4, by = c("region", "hemi"))
male_baseline_plot <- male_baseline_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Baseline Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.05, 0.39)
) +
theme_void()
male_year2_plot <- male_year2_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 2 Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.05, 0.39)
) +
theme_void()
male_year4_plot <- male_year4_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 4 Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.05, 0.39)
) +
theme_void()
male_baseline_plot
male_year2_plot
male_year4_plot
area_male_RMSE <- area_male_RMSE_ind_region_event %>%
mutate(
abv = str_remove(region_raw, "^smri_area_cdk_"),
abv = str_remove(abv, "\\.combat$")
) %>%
mutate(
hemi = case_when(
str_detect(abv, "lh$") ~ "left",
str_detect(abv, "rh$") ~ "right",
TRUE ~ NA_character_
)
) %>%
filter(!abv %in%
c("total", "totallh", "totalrh")) %>%
rowwise() %>%
mutate(region = get_name(dk_abv_to_names, abv)) %>%
ungroup()
area_male_RMSE_baseline <- area_male_RMSE %>%
filter(event_time == "Baseline")
area_male_RMSE_year2 <- area_male_RMSE %>%
filter(event_time == "Year 2")
area_male_RMSE_year4 <- area_male_RMSE %>%
filter(event_time == "Year 4")
male_baseline_joined <- brain_join(dk_df, area_male_RMSE_baseline, by = c("region", "hemi"))
male_year2_joined <- brain_join(dk_df, area_male_RMSE_year2, by = c("region", "hemi"))
male_year4_joined <- brain_join(dk_df, area_male_RMSE_year4, by = c("region", "hemi"))
male_baseline_plot <- male_baseline_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Baseline Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
) +
theme_void()
male_year2_plot <- male_year2_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 2 Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
) +
theme_void()
male_year4_plot <- male_year4_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 4 Male") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
) +
theme_void()
male_baseline_plot
male_year2_plot
male_year4_plot
area_female_RMSE_ind_region_long <- area_centile_female %>%
select(current_col_name, race_ethnicity,
residual_baseline_year_1_arm_1,
residual_2_year_follow_up_y_arm_1,
residual_4_year_follow_up_y_arm_1) %>%
pivot_longer(
cols = starts_with("residual_"),
names_to = "event_time",
values_to = "residual"
) %>%
mutate(residual_sqr = residual^2) %>%
mutate(event_time = case_when(
str_detect(event_time, "baseline") ~ "Baseline",
str_detect(event_time, "2_year") ~ "Year 2",
str_detect(event_time, "4_year") ~ "Year 4"
))
area_female_RMSE_ind_region_event <- area_female_RMSE_ind_region_long %>%
group_by(current_col_name, race_ethnicity, event_time) %>%
summarize(
RMSE_residual = sqrt(mean(residual_sqr, na.rm = TRUE)),
.groups = "drop"
) %>%
rename(region_raw = current_col_name)
overall_area_female_RMSE_ind_region_event <- area_female_RMSE_ind_region_long %>%
group_by(current_col_name, event_time) %>%
summarize(
race_ethnicity = "All",
RMSE_residual = sqrt(mean(residual_sqr, na.rm = TRUE)),
.groups = "drop"
) %>%
rename(region_raw = current_col_name)
area_female_RMSE_ind_region_event <- bind_rows(
area_female_RMSE_ind_region_event,
overall_area_female_RMSE_ind_region_event
)
area_female_RMSE <- area_female_RMSE_ind_region_event %>%
mutate(
abv = str_remove(region_raw, "^smri_area_cdk_"),
abv = str_remove(abv, "\\.combat$")
) %>%
mutate(
hemi = case_when(
str_detect(abv, "lh$") ~ "left",
str_detect(abv, "rh$") ~ "right",
TRUE ~ NA_character_
)
) %>%
filter(!abv %in%
c("total", "totallh", "totalrh")) %>%
rowwise() %>%
mutate(region = get_name(dk_abv_to_names, abv)) %>%
ungroup()
area_female_RMSE_baseline <- area_female_RMSE %>%
filter(event_time == "Baseline")
area_female_RMSE_year2 <- area_female_RMSE %>%
filter(event_time == "Year 2")
area_female_RMSE_year4 <- area_female_RMSE %>%
filter(event_time == "Year 4")
female_baseline_joined <- brain_join(dk_df, area_female_RMSE_baseline, by = c("region", "hemi"))
female_year2_joined <- brain_join(dk_df, area_female_RMSE_year2, by = c("region", "hemi"))
female_year4_joined <- brain_join(dk_df, area_female_RMSE_year4, by = c("region", "hemi"))
female_baseline_plot <- female_baseline_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Baseline Female") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.03, 0.39)
) +
theme_void()
female_year2_plot <- female_year2_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 2 Female") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.03, 0.39)
) +
theme_void()
female_year4_plot <- female_year4_joined %>%
mutate(hover = paste0(region, ": ", round(RMSE_residual, 3))) %>%
drop_na() %>%
group_by(race_ethnicity) %>%
ggplot() +
geom_brain(atlas = dk,
position = position_brain(hemi ~ side),
mapping = aes(fill = RMSE_residual)) +
labs(title = "Average Residual From Predicted Curve by Race/Ethnicity",
subtitle = "Year 4 Female") +
facet_wrap(~race_ethnicity) +
scale_fill_gradientn(
name = "RMSE in mm",
colors = hcl.colors(10, "purple-yellow"), # use this to change color
limits = c(0.03, 0.39)
) +
theme_void()
female_baseline_plot
female_year2_plot
female_year4_plot
library(rsconnect)
library(shiny)
